# nonebot_plugin_wft

基于 nonebot2 和 onebot11 协议的狼人杀插件

此插件仍然处于重构状态

## 使用

### 管理指令（需要群主/管理员，且需 @机器人）

- `@机器人 wftconfig.enable`：在当前群启用插件
- `@机器人 wftconfig.disable`：在当前群禁用插件
- `@机器人 wftconfig.ban <qq...>`：拉黑用户（不响应其游戏指令）
- `@机器人 wftconfig.unban <qq...>`：解除拉黑

### 房间与大厅

- `wft.init`：创建房间
  - 若上一局已结束（游戏状态为 `ended`），再次 `wft.init` 会创建新房间，并保留上一局的玩家列表与角色配置（方便快速再来一局）
- `@机器人 wft.end`：结束当前房间（清空本群房间）
- `wft.join`：加入游戏（仅大厅阶段可用）
- `wft.exit`：退出游戏（仅大厅阶段可用）
- `wft.addrole <角色...>`：添加角色配置（按别名；可一次添加多个）
- `wft.rmrole <角色...>`：删除角色配置
- `wft.autoroles`：自动配置角色（当前实现：按人数配置狼人 + 1 预言家，其余补足为村民）
- `wft.showroles`：显示当前已配置角色
- `wft.start`：开始游戏（分配身份并进入夜晚）

### 夜晚技能（可群聊或私聊）

所有夜晚技能统一通过 `wft.skill ...` 与 `wft.skip` 触发。
如果你同时在多个群的游戏中，私聊时需要指定群号：

- `wft.skill -g <群号> <动作> [参数]`
- `wft.skill <群号> <动作> [参数]`
- `wft.skip -g <群号>`
- `wft.skip <群号>`

当前已实现角色与用法：

- 狼人：`wft.skill kill <编号>`（或 `wft.skip` 放弃本夜击杀投票）
- 预言家：`wft.skill check <编号>`（或 `wft.skip` 放弃本夜查验）
- 守卫：`wft.skill guard <编号>`（或 `wft.skip` 放弃本夜守护；不可连续两晚守同一人）
- 女巫：
  - `wft.skill save` 使用解药（仅在狼刀锁定后可救人；解药一局一次）
  - `wft.skill poison <编号>` 使用毒药（毒药一局一次）
  - `wft.skip` 放弃本夜用药

### 白天发言与投票

- 夜晚结算后先进入白天发言阶段：按编号顺序依次发言
  - 每个白天发言顺序翻转一次：第 1 天从小到大，第 2 天从大到小，以此类推
  - 当前发言玩家发送 `wft.skip` 结束发言并轮到下一位
- 发言结束后自动进入投票：
  - `wft.vote <编号>` 投票放逐
  - `wft.skip` 弃票

## 架构

### `__init__.py`

和机器人交互与用户通信相关的内容

所有和游戏流程相关的指令都应该触发一个对应的事件

### 事件

事件系统按 房间 进行独立处理

每个事件都会在被触发时执行相应的监听器

事件 应该是一个 对象

每个 房间 都有一个 事件系统

事件系统 内部有若干个 事件 成员

事件 具有 触发事件，添加监听器，删除监听器 函数

监听器 是 一个接受 房间 对象的函数

事件类型相关代码与事件系统实现均保存在 `game/` 目录下（如 `event_system.py`、`event_base.py`）。

### 玩家

每个 房间 都应该有一个 玩家列表 用来保存 玩家对象

玩家列表 按 发言顺序 排序，每个玩家的发言顺序 被称作 玩家编号

房间 具有一个字典 存储 玩家 QQ 号 -> 玩家编号

玩家 具有一个 角色

### 角色

角色 在 游戏开始 时执行 分配角色 操作时被 创建 并赋值给 每个玩家

角色 在 被创建时 接受 房间 参数 并向 事件系统 注册一系列 监听器

每个 角色 类型 的实现文件均保存在 `game/` 目录下，并以 `character_` 前缀命名
（例如 `character_wolf.py`、`character_seer.py`）。

角色类型通过扫描 `game/` 下以 `character_` 开头的模块进行动态加载。
